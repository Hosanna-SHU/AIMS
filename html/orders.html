<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders</title>
    <link rel="stylesheet" href="css/Dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-2 d-md-block bg-dark text-white vh-100 p-3 sidebar">
            <h2 class="text-center py-3">AIMS</h2>
            <ul class="nav flex-column">
                <li class="nav-item"><a href="index.html" class="nav-link text-light">Dashboard</a></li>
                <li class="nav-item"><a href="products.html" class="nav-link text-light">Products</a></li>
                <li class="nav-item"><a href="inventory.html" class="nav-link text-light">Inventory</a></li>
                <li class="nav-item"><a href="orders.html" class="nav-link text-light active">Orders</a></li>
            </ul>
            <button class="btn btn-warning w-100 mt-3">Logout</button>
        </nav>

        <!-- Main Content -->
        <main class="col-md-10 ms-sm-auto px-md-4">
            <header class="d-flex justify-content-between align-items-center py-3 border-bottom">
                <div>
                    <h5 class="mb-0">Good Morning, John!</h5>
                    <small>Thursday 07 November 2024</small>
                </div>
                <div class="d-flex align-items-center">
                    <span class="user-icon">ðŸ‘¤</span>
                    <span class="username mx-2">John Doe</span>
                    <small>Admin</small>
                </div>
            </header>


            <!-- Orders Table -->
            <section class="orders-table mt-4">
                <h2>Current Orders</h2>
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>Order Number</th>
                            <th>Item Name</th>
                            <th>Quantity</th>
                            <th>Size</th>
                            <th>Price</th>
                            <th>Total Price</th>
                        </tr>
                    </thead>
                    <tbody id="orderTable">
                        <!-- Dynamically populated rows -->
                    </tbody>
                </table>

                <!-- Buttons -->
                <div class="d-flex justify-content-between mt-3">
                    <button class="btn btn-danger" onclick="clearTable()">Clear Orders</button>
                    <button class="btn btn-primary" onclick="window.location.href = 'products.html'">Add more products</button>
                    <button class="btn btn-success" onclick="printInvoice()">Print Invoice/Receipt</button>
                </div>
            </section>
        </main>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script>
    // Load products from products.html (simulated as a JSON)
    function loadProducts() {
        // Example: products data (this could come from a dynamic API call)
        const products = [
            { id: 1, name: "T-Shirt", price: 10.99 },
            { id: 2, name: "Jeans", price: 29.99 },
            { id: 3, name: "Jacket", price: 49.99 },
        ];

        const productSelect = document.getElementById('productSelect');
        products.forEach(product => {
            const option = document.createElement('option');
            option.value = product.id;
            option.textContent = `${product.name} - Â£${product.price.toFixed(2)}`;
            productSelect.appendChild(option);
        });

        localStorage.setItem('products', JSON.stringify(products)); // Save products to localStorage
    }

    // Load current orders from localStorage
    function loadOrders() {
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        const tableBody = document.getElementById('orderTable');
        tableBody.innerHTML = ''; // Clear the table before populating

        orders.forEach((order, index) => {
            const totalPrice = (order.quantity * order.price).toFixed(2); // Calculate total price for each order
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${order.itemName}</td>
                <td>${order.quantity}</td>
                <td>${order.size}</td>
                <td>Â£${order.price}</td>
                <td>Â£${totalPrice}</td>
            `;
            tableBody.appendChild(row);
        });

        // Update the total price for all orders at the bottom
        updateTotalPrice();
    }

    // Add new product to the order list in localStorage
    document.getElementById('orderForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const productId = document.getElementById('productSelect').value;
        const quantity = document.getElementById('quantity').value;
        const size = document.getElementById('size').value;

        const products = JSON.parse(localStorage.getItem('products')) || [];
        const selectedProduct = products.find(product => product.id == productId);

        if (!selectedProduct) {
            alert('Product not found.');
            return;
        }

        const newOrder = { 
            itemName: selectedProduct.name, 
            price: selectedProduct.price, 
            quantity, 
            size
        };

        // Get existing orders or create an empty array
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        orders.push(newOrder);
        localStorage.setItem('orders', JSON.stringify(orders));

        loadOrders(); // Refresh the order table
        e.target.reset(); // Clear the form
    });

    // Clear all orders from the table and localStorage
    function clearTable() {
        if (confirm('Are you sure you want to clear all orders?')) {
            localStorage.removeItem('orders');
            loadOrders(); // Refresh the order table
            alert('All orders cleared.');
        }
    }

    // Update the total price for all orders
    function updateTotalPrice() {
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        let totalAmount = 0;
        orders.forEach(order => {
            totalAmount += order.quantity * order.price;
        });

        const totalElement = document.getElementById('totalPrice');
        if (!totalElement) {
            // Add a new element for total price if it doesn't exist
            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td colspan="5" class="text-end"><strong>Total:</strong></td>
                <td><strong>Â£${totalAmount.toFixed(2)}</strong></td>
            `;
            document.getElementById('orderTable').appendChild(totalRow);
        } else {
            // If the total row exists, update its value
            totalElement.textContent = `Â£${totalAmount.toFixed(2)}`;
        }
    }

    // Generate and print invoice/receipt
    function printInvoice() {
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        const totalAmount = orders.reduce((total, order) => total + (order.quantity * order.price), 0);

        // Print logic can go here, similar to the previous implementation
        // (you can create a new window and format the invoice with the orders and total amount)
    }

    // Load products when page is loaded
    window.onload = function () {
        loadProducts();
        loadOrders();
    };
</script>
</body>
</html>
